<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ì¼ê°„ì°¨íŠ¸</title>
    <script>
      function getYesterdayDateString() {
        const d = new Date();
        d.setDate(d.getDate() - 1);
        return d.toISOString().slice(0, 10); // yyyy-MM-dd
      }
      async function fetchChart() {
        const date = document.getElementById("chartDate").value;
        if(!date) return;

        const response = await fetch(`/api/chart/daily?date=${date}`);
        const data = await response.json();

        const tbody = document.getElementById("chartBody");
        tbody.innerHTML = "";

        data.forEach(song => {
          const row = `<tr>
                    <td>${song.chartRank}</td>
                    <td>${song.title}</td>
                    <td>${song.artist}</td>
                    <td>${song.playCount}</td>
                    <td>
                      <button onclick="playMusic(${song.musicId}, '${song.youtubeUrl}')">â–¶ï¸ ì¬ìƒ</button>
                    </td>
                </tr>`;
          tbody.innerHTML += row;
        });
      }

      function playMusic(musicId, youtubeId) {
        const userId = 1;
        console.log("ìŒì›ì¬ìƒ", musicId, youtubeId);

        fetch(`/api/play?musicId=${musicId}&userId=${userId}`, {
          method: 'POST'
        }).then(response => {
          if (response.ok) {
            const iframe = document.getElementById("player");
            iframe.src = `https://www.youtube.com/embed/${youtubeId}?autoplay=1`;
          } else {
            alert("ì¬ìƒ ì‹¤íŒ¨");
          }
        });
      }

      window.onload = function () {
        const dateInput = document.getElementById("chartDate");
        const yesterdayStr = getYesterdayDateString();
        dateInput.value = yesterdayStr;
        fetchChart();
      };
    </script>
</head>
<body>
  <h1>ì¼ê°„ ì°¨íŠ¸</h1>
  <input type="date" id="chartDate"/>
  <button onclick="fetchChart()">ì¡°íšŒ</button>

  <table>
    <thead>
      <tr>
        <th>ìˆœìœ„</th>
        <th>ì œëª©</th>
        <th>ì•„í‹°ìŠ¤íŠ¸</th>
        <th>ì¬ìƒìˆ˜</th>
        <th>ì¬ìƒ</th>
      </tr>
    </thead>
    <tbody id="chartBody"></tbody>
  </table>

  <hr>
  <h2>ğŸ“º í˜„ì¬ ì¬ìƒ ì¤‘</h2>
  <iframe id="player" width="560" height="315" src="" frameborder="0"
          allow="autoplay; encrypted-media" allowfullscreen></iframe>

</body>
</html>