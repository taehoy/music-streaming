<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ìŒì› ê²€ìƒ‰</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            display: flex;
        }

        /* ì™¼ìª½ ì‚¬ì´ë“œë°” */
        #sideNav {
            width: 160px;
            background-color: #f4f4f4;
            border-right: 1px solid #ccc;
            padding: 20px;
            box-sizing: border-box;
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1000;
        }

        #sideNav button,
        #sideNav input {
            width: 100%;
            font-size: 14px;
            padding: 8px;
            margin-bottom: 8px;
            box-sizing: border-box;
        }

        #sideNav input[type="text"] {
            border: 1px solid #ccc;
        }

        /* ì˜¤ë¥¸ìª½ ë³¸ë¬¸ */
        #mainContent {
            margin-left: 160px;
            padding: 20px;
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border-bottom: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        img {
            border-radius: 4px;
        }
    </style>

    <script>
        let selectedMusicId = null;

        function searchMusic() {
            const keyword = document.getElementById("keywordInput").value.trim();
            if (!keyword) return;

            fetch(`/api/music/search?keyword=${encodeURIComponent(keyword)}`)
                .then(res => res.json())
                .then(musicList => {
                    const tbody = document.getElementById("resultsBody");
                    tbody.innerHTML = "";

                    if (musicList.length === 0) {
                        document.getElementById("resultsTable").style.display = "none";
                        alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        return;
                    }

                    document.getElementById("resultsTable").style.display = "table";

                    musicList.forEach(music => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                              <td>${music.title}</td>
                              <td>${music.artist}</td>
                              <td>${music.album}</td>
                              <td><img src="${music.coverImageUrl}" width="50"/></td>
                              <td><button onclick="playMusic(${music.musicId}, '${music.youtubeUrl}')">â–¶ï¸</button></td>
                              <td><button onclick="addToPlaylist(${music.musicId})">â•</button></td>
                            `;
                        tbody.appendChild(row);
                    });
                });
        }

        function playMusic(musicId, youtubeUrl) {
            const userId = 1; // ë¡œê·¸ì¸ êµ¬í˜„ ì „ê¹Œì§€ëŠ” ê³ ì •
            fetch(`/api/play?musicId=${musicId}&userId=${userId}`, { method: 'POST' })
                .then(res => {
                    if (res.ok) {
                        document.getElementById("player").src = `https://www.youtube.com/embed/${youtubeUrl}?autoplay=1`;
                    } else {
                        alert("ì¬ìƒ ì‹¤íŒ¨");
                    }
                });
        }

        function addToPlaylist(musicId) {
            const playlistId = prompt("ì¶”ê°€í•  í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (!playlistId) return;

            fetch(`/api/playlists/${playlistId}/music`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ musicId })
            }).then(res => {
                alert(res.ok ? "ì¶”ê°€ ì™„ë£Œ!" : "ì¶”ê°€ ì‹¤íŒ¨ (ì¤‘ë³µ ë˜ëŠ” ì˜¤ë¥˜)");
            });
        }
    </script>
</head>
<body>
<!-- âœ… ì™¼ìª½ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav id="sideNav">
    <form id="searchForm" onsubmit="event.preventDefault(); searchMusic();">
        <input type="text" id="keywordInput" placeholder="ğŸ” ê²€ìƒ‰ì–´ ì…ë ¥">
        <button type="submit">ê²€ìƒ‰</button>
    </form>

    <button onclick="location.href='/'">ğŸ  í™ˆ</button>
    <button onclick="location.href='/me/playlists'">ğŸ“‹ ë§ˆì´í˜ì´ì§€</button>
    <button onclick="location.href='/chart/daily'">ğŸ“… ì¼ê°„ì°¨íŠ¸</button>
</nav>

<!-- âœ… ì˜¤ë¥¸ìª½ ë³¸ë¬¸ -->
<main id="mainContent">
    <h1>ğŸ” ê²€ìƒ‰ ê²°ê³¼</h1>

    <table id="resultsTable" style="display: none;">
        <thead>
        <tr>
            <th>ì œëª©</th>
            <th>ì•„í‹°ìŠ¤íŠ¸</th>
            <th>ì•¨ë²”</th>
            <th>ì»¤ë²„</th>
            <th>ì¬ìƒ</th>
            <th>ì¶”ê°€</th>
        </tr>
        </thead>
        <tbody id="resultsBody">
        <!-- JSê°€ ì±„ì›€ -->
        </tbody>
    </table>

    <h2>ğŸ“º í˜„ì¬ ì¬ìƒ ì¤‘</h2>
    <iframe id="player" width="560" height="315" src="" frameborder="0"
            allow="autoplay; encrypted-media" allowfullscreen></iframe>
</main>
</body>
</html>